<!DOCTYPE html>
<html lang="en">
<head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H57NFG20DE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-H57NFG20DE');
</script>

    <meta charset="UTF-8">
    <!-- SEO Meta Tags -->
    <title>Colordle - Daily Color Guessing Game</title>
    <meta name="description" content="Play Colordle, the daily color guessing game. Guess the hidden color name or hex code based on visual clues. A free Wordle-style game.">
    <meta name="keywords" content="colordle, color game, color guessing, hex code game, wordle for colors, daily puzzle">
    <meta name="author" content="Osmanyo">
    
    <meta property="og:title" content="Colordle - Guess the Daily Color">
    <meta property="og:description" content="Can you guess today's color?">
    <!-- <meta property="og:image" content="https://osmanyo.github.io/colordle/preview-image.png"> Add a screenshot later -->
    <meta property="og:url" content="https://osmanyo.github.io/colordle/">
    <meta property="og:type" content="website">
    
    <link rel="canonical" href="https://osmanyo.github.io/colordle/" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colordle</title>
    <style>
        :root {
            --bg-color: #121213;
            --text-color: #ffffff;
            --border-color: #3a3a3c;
            --input-bg: #2c2c2e;
            --accent-color: #00d2ff;
            --danger-color: #c92a2a;
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        h1 { margin-top: 20px; letter-spacing: 1px; }

        .game-container {
            width: 100%; max-width: 500px; padding: 20px; box-sizing: border-box;
            padding-bottom: 80px;
        }

        /* --- UI ELEMENTS --- */
        .target-preview {
            background-color: #333; padding: 15px; border-radius: 8px;
            text-align: center; margin-bottom: 20px;
            border: 1px solid var(--border-color);
            display: none;
        }

        .input-group {
            position: relative; display: flex; gap: 10px; margin-bottom: 20px; align-items: center;
        }

        #inputPreview {
            width: 50px; height: 50px; border-radius: 50%;
            background-color: transparent;
            border: 2px solid var(--border-color);
            flex-shrink: 0; transition: background-color 0.2s;
        }

        input[type="text"] {
            flex-grow: 1; padding: 12px; font-size: 16px;
            background-color: var(--input-bg); border: 1px solid var(--border-color);
            color: white; border-radius: 4px; outline: none;
        }

        button {
            padding: 12px 20px; font-size: 16px; font-weight: bold;
            background-color: #fff; color: #000; border: none;
            border-radius: 4px; cursor: pointer;
        }
        button:hover { background-color: #e0e0e0; }
        
        .danger-btn {
            background-color: var(--danger-color); color: white; width: 100%;
        }
        .danger-btn:hover { background-color: #e03131; }

        /* --- SETTINGS ICON --- */
        #settingsIcon {
            position: absolute; top: 20px; right: 20px;
            cursor: pointer; opacity: 0.7; transition: opacity 0.2s;
        }
        #settingsIcon:hover { opacity: 1; }
        #settingsIcon svg { width: 24px; height: 24px; fill: white; }

        /* --- SETTINGS MODAL --- */
        #settingsModal {
            display: none; position: absolute; top: 60px; right: 20px;
            background: #1a1a1a; border: 1px solid var(--border-color);
            padding: 15px; border-radius: 8px; width: 250px;
            z-index: 200; box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .setting-row { margin-bottom: 15px; }
        .setting-label { display: block; margin-bottom: 5px; font-size: 14px; color: #aaa; }
        input[type="range"] { width: 100%; }
        select {
            width: 100%; padding: 5px; background: #000; color: white; 
            border: 1px solid #333; border-radius: 4px;
        }
        .separator { border-top: 1px solid #333; margin: 15px 0; }

        /* --- SUGGESTIONS --- */
        .suggestions-list {
            position: absolute; top: 100%; left: 60px;
            width: calc(100% - 60px);
            max-height: 200px; overflow-y: auto;
            background-color: #222; border: 1px solid var(--border-color);
            z-index: 100; display: none;
        }

        .suggestion-item {
            padding: 10px; display: flex; align-items: center;
            cursor: pointer; border-bottom: 1px solid #333;
        }
        .suggestion-item:hover { background-color: #333; }

        .mini-swatch {
            width: 20px; height: 20px; border-radius: 50%;
            margin-right: 10px; border: 1px solid #555;
        }

        /* --- HISTORY LIST --- */
        .guess-history {
            display: flex; flex-direction: column; gap: 8px; margin-top: 20px;
        }

        .guess-row {
            display: flex; align-items: center;
            padding: 15px 15px;
            border-radius: 6px;
            border: 1px solid rgba(0,0,0,0.1);
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .guess-num { width: 40px; opacity: 0.8; font-size: 0.9em; }
        .guess-name { flex-grow: 1; text-align: left; }
        .guess-score { width: 60px; text-align: right; }

        /* --- SEED CONTROL --- */
        #seedControl {
            position: fixed; bottom: 20px; left: 20px;
            background: #1a1a1a; padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px; display: flex; gap: 5px;
            align-items: center; z-index: 200;
        }
        #seedControl span { font-size: 12px; color: #aaa; margin-right: 5px; }
        #seedInput {
            width: 60px; padding: 5px; font-size: 13px; height: auto;
            text-align: center; background: #000; border: 1px solid #333; color:white;
        }
        #seedBtn {
            padding: 5px 10px; font-size: 13px; height: auto;
            background: #444; color: #fff;
        }
        #seedBtn:hover { background: #666; }
    </style>
</head>
<body>

    <a href="explore.html" style="position:absolute; top:20px; left:20px; color:#00d2ff; text-decoration:none; font-weight:bold; font-family:sans-serif;">Explore in 3D</a>
    <!-- SETTINGS ICON -->
    <div id="settingsIcon">
        <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="settingsModal">
        <div class="setting-row">
            <label class="setting-label">Max Suggestions: <span id="maxCountDisplay">5</span></label>
            <input type="range" id="maxSuggestionsInput" min="3" max="50" value="5">
        </div>
        <div class="setting-row">
            <label class="setting-label">Sort History By:</label>
            <select id="sortOrderInput">
                <option value="latest">Latest Guess First</option>
                <option value="best">Best Score First</option>
            </select>
        </div>
        <div class="separator"></div>
        <div class="setting-row">
            <!-- RESET BUTTON -->
            <button id="resetGameBtn" class="danger-btn">Reset Current Game</button>
        </div>
    </div>

    <h1>Colordle</h1>

    <div class="game-container">
        <div id="targetDisplay" class="target-preview"></div>

        <div class="input-group">
            <div id="inputPreview"></div>
            <input type="text" id="guessInput" placeholder="Name (Red) or Hex (#ff0000)..." autocomplete="off">
            <button id="guessBtn">Guess</button>
            <div id="suggestions" class="suggestions-list"></div>
        </div>

        <div id="historyList" class="guess-history"></div>
    </div>

    <div id="seedControl">
        <span>Seed:</span>
        <input type="number" id="seedInput" value="">
        <button id="seedBtn">Load</button>
    </div>

    <script type="module">
        import { converter, differenceCiede2000, parse } from 'https://esm.sh/culori@3';

        const CSV_URL = 'colornames.csv';

        const toLab = converter('lab');
        const calcDeltaE = differenceCiede2000();

        let ALL_COLORS = [];
        let guessCount = 0;
        let targetColor = null;
        let targetLab = null;
        let currentSeed = null;

        // Preferences
        let maxSuggestions = 5;
        let sortOrder = 'best'; 

        let gameState = { seed: null, won: false, guesses: [] };

        async function loadColors() {
            try {
                const response = await fetch(CSV_URL);
                const text = await response.text();
                const lines = text.split('\n');
                for(let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if(line) {
                        const parts = line.split(','); 
                        if(parts.length >= 2) {
                            ALL_COLORS.push({
                                name: parts[0].trim(),
                                hex: parts[1].trim(),
                                isGood: parts[2] && parts[2].trim().toLowerCase() === 'x'
                            });
                        }
                    }
                }
                initGame();
            } catch (err) {
                console.error("Error loading CSV", err);
            }
        }

        window.setGameSeed = (seed) => initGame(seed);

        function initGame(customSeed = null) {
            document.getElementById('historyList').innerHTML = '';
            document.getElementById('targetDisplay').style.display = 'none';
            document.getElementById('guessInput').value = '';
            document.getElementById('inputPreview').style.backgroundColor = 'transparent';

            currentSeed = customSeed !== null ? customSeed : Math.floor(Date.now() / 86400000);
            document.getElementById('seedInput').value = currentSeed;

            const savedData = localStorage.getItem('colordle_save');
            if (savedData) {
                const parsed = JSON.parse(savedData);
                if (parsed.seed === currentSeed) {
                    gameState = parsed;
                    guessCount = gameState.guesses.length; 
                } else {
                    gameState = { seed: currentSeed, won: false, guesses: [] };
                    guessCount = 0;
                    localStorage.removeItem('colordle_save');
                }
            } else {
                gameState = { seed: currentSeed, won: false, guesses: [] };
                guessCount = 0;
            }

            const goodColors = ALL_COLORS.filter(c => c.isGood);
            const pool = goodColors.length > 0 ? goodColors : ALL_COLORS;
            const targetIndex = Math.abs(currentSeed) % pool.length;
            targetColor = pool[targetIndex];
            targetLab = toLab(parse(targetColor.hex));

            console.log(`Seed: ${currentSeed}. Target: ${targetColor.name}`);

            renderHistory();
            if (gameState.won) revealWin(false);
        }

        function resetCurrentGame() {
            if(!confirm("Are you sure you want to reset progress for this color?")) return;
            
            // Reset logic
            gameState.guesses = [];
            gameState.won = false;
            guessCount = 0;
            saveGame(); // Overwrites storage with empty state

            // UI Reset
            document.getElementById('historyList').innerHTML = '';
            document.getElementById('targetDisplay').style.display = 'none';
            document.getElementById('settingsModal').style.display = 'none';
            document.getElementById('guessInput').value = '';
            document.getElementById('inputPreview').style.backgroundColor = 'transparent';
        }

        function getContrastYIQ(hexcolor){
            hexcolor = hexcolor.replace("#", "");
            if(hexcolor.length === 3) hexcolor = hexcolor.split('').map(c=>c+c).join('');
            var r = parseInt(hexcolor.substr(0,2),16);
            var g = parseInt(hexcolor.substr(2,2),16);
            var b = parseInt(hexcolor.substr(4,2),16);
            var yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 128) ? '#000000' : '#ffffff';
        }

        function handleGuess() {
            if (gameState.won) return;

            const input = document.getElementById('guessInput');
            const val = input.value.trim();
            let guessHex = null;
            let guessDisplayName = val;

            if (val.startsWith('#')) {
                if (parse(val)) {
                    guessHex = val;
                    const known = ALL_COLORS.find(c => c.hex.toLowerCase() === val.toLowerCase());
                    if (known) guessDisplayName = known.name;
                }
            } else {
                const found = ALL_COLORS.find(c => c.name.toLowerCase() === val.toLowerCase());
                if (found) {
                    guessHex = found.hex;
                    guessDisplayName = found.name;
                }
            }

            if (!guessHex) return;

            if (gameState.guesses.some(g => g.hex.toLowerCase() === guessHex.toLowerCase())) {
                alert("You already guessed that!");
                return;
            }

            const guessLab = toLab(parse(guessHex));
            let deltaE = calcDeltaE(targetLab, guessLab);
            if (isNaN(deltaE)) deltaE = 0;
            const percentage = Math.max(0, 100 - deltaE).toFixed(2);
            
            guessCount++;

            const newGuess = {
                number: guessCount,
                name: guessDisplayName,
                hex: guessHex,
                score: percentage
            };
            
            gameState.guesses.push(newGuess);
            
            if (deltaE < 0.5) {
                gameState.won = true;
                revealWin(true);
            }

            saveGame();
            renderHistory();

            input.value = '';
            document.getElementById('inputPreview').style.backgroundColor = 'transparent';
            document.getElementById('suggestions').style.display = 'none';
        }

        function saveGame() {
            localStorage.setItem('colordle_save', JSON.stringify(gameState));
        }

        function renderHistory() {
            const container = document.getElementById('historyList');
            container.innerHTML = '';

            let sortedGuesses = [...gameState.guesses];

            if (sortOrder === 'latest') {
                sortedGuesses.reverse();
            } else {
                sortedGuesses.sort((a, b) => parseFloat(b.score) - parseFloat(a.score));
            }

            sortedGuesses.forEach(g => {
                const row = document.createElement('div');
                const textColor = getContrastYIQ(g.hex);

                row.className = 'guess-row';
                row.style.backgroundColor = g.hex;
                row.style.color = textColor;
                row.style.borderColor = textColor === '#ffffff' ? 'rgba(255,255,255,0.3)' : 'rgba(0,0,0,0.1)';

                row.innerHTML = `
                    <span class="guess-num">#${g.number}</span>
                    <div class="guess-details">
                        <span class="guess-name">${g.name}</span>
                        <span class="guess-score">${g.score}%</span>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function revealWin(animate = true) {
            const display = document.getElementById('targetDisplay');
            display.style.display = 'block';
            display.innerHTML = `
                <h2>ðŸŽ‰ YOU WON!</h2>
                <p>The color was <b>${targetColor.name}</b></p>
                <div style="margin:10px auto; width:100px; height:40px; background:${targetColor.hex}; border:2px solid #555; border-radius:4px;"></div>
            `;
            if(animate) window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- EVENTS ---
        const inputEl = document.getElementById('guessInput');
        const previewEl = document.getElementById('inputPreview');
        const suggestions = document.getElementById('suggestions');

        document.addEventListener('click', (e) => {
            const isClickInside = inputEl.contains(e.target) || suggestions.contains(e.target);
            if (!isClickInside) {
                suggestions.style.display = 'none';
            }
        });

        const settingsIcon = document.getElementById('settingsIcon');
        const settingsModal = document.getElementById('settingsModal');
        
        settingsIcon.addEventListener('click', (e) => {
            e.stopPropagation(); 
            const isVisible = settingsModal.style.display === 'block';
            settingsModal.style.display = isVisible ? 'none' : 'block';
        });

        // RESET BTN
        document.getElementById('resetGameBtn').addEventListener('click', resetCurrentGame);

        const maxInput = document.getElementById('maxSuggestionsInput');
        maxInput.addEventListener('input', (e) => {
            maxSuggestions = parseInt(e.target.value);
            document.getElementById('maxCountDisplay').innerText = maxSuggestions;
        });

        const sortInput = document.getElementById('sortOrderInput');
        sortInput.addEventListener('change', (e) => {
            sortOrder = e.target.value;
            renderHistory();
        });

        inputEl.addEventListener('input', (e) => {
            const val = e.target.value.trim().toLowerCase();
            suggestions.innerHTML = '';
            
            let validColor = parse(val);
            if(!validColor && val.length > 1) {
                const found = ALL_COLORS.find(c => c.name.toLowerCase() === val);
                if(found) validColor = found.hex;
            }
            previewEl.style.backgroundColor = validColor ? (typeof validColor === 'string' ? validColor : val) : 'transparent';

            if (val.length < 2 || val.startsWith('#')) { 
                suggestions.style.display = 'none'; 
                return; 
            }

            let matches = ALL_COLORS.filter(c => c.name.toLowerCase().includes(val));
            matches.sort((a, b) => {
                const aName = a.name.toLowerCase();
                const bName = b.name.toLowerCase();
                if (aName === val) return -1;
                if (bName === val) return 1;
                return aName.startsWith(val) ? -1 : 1;
            });

            matches = matches.slice(0, maxSuggestions);

            if (matches.length > 0) {
                suggestions.style.display = 'block';
                matches.forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerHTML = `<div class="mini-swatch" style="background:${c.hex}"></div>${c.name}`;
                    div.onclick = () => {
                        inputEl.value = c.name;
                        previewEl.style.backgroundColor = c.hex;
                        suggestions.style.display = 'none';
                        inputEl.focus();
                    };
                    suggestions.appendChild(div);
                });
            } else {
                suggestions.style.display = 'none';
            }
        });

        inputEl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const val = inputEl.value.trim().toLowerCase();
                const exactMatch = ALL_COLORS.find(c => c.name.toLowerCase() === val);
                const isHex = val.startsWith('#') && parse(val);

                if (exactMatch || isHex) {
                    handleGuess();
                    suggestions.style.display = 'none';
                } else if (suggestions.style.display === 'block' && suggestions.firstChild) {
                    suggestions.firstChild.click();
                }
            }
        });

        document.getElementById('guessBtn').addEventListener('click', handleGuess);
        
        document.getElementById('seedBtn').addEventListener('click', () => {
            const val = parseInt(document.getElementById('seedInput').value);
            if(!isNaN(val)) initGame(val);
        });

        loadColors();

    </script>
</body>
</html>